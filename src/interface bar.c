#include "globals extern.h"void	DrawInterfaceBar( void ){	Rect		tempRect;	PicHandle 	tempPict;	short		oldFile;		#ifndef DEMO		HackCheckFour();		CheckRegistrationFour();	#endif	oldFile = CurResFile();		UseResFile(theFileStuff.GWDataFileNumber);	SetRect(&tempRect, 0, 0, 640, 480);	SetGWorld(theGWorlds.screenGWorld, nil);	tempPict = GetPicture(4500);		// interface bar	if (tempPict == nil) FatalError("Error loading PICT 4500", true);	DrawPicture(tempPict, &tempRect);	ReleaseResource((Handle)tempPict);		UseResFile(theFileStuff.worldFile);	tempPict = GetPicture(202);		// year	if (tempPict == nil) FatalError("Error loading PICT 202", true);	SetRect(&tempRect, 321, 437, 420 , 455);	DrawPicture(tempPict, &tempRect);	ReleaseResource((Handle)tempPict);		SetRect(&tempRect, 0, 0, 640, 480);	SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());		#ifndef DEMO		if (!gRegistered) FatalError("Error drawing screen border", true);	#endif		ForeColor(blackColor);	BackColor(whiteColor);		CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits,						&tempRect, &tempRect, srcCopy, ( RgnHandle )0L );	UseResFile(oldFile);		DrawLifeBar(); DrawStaminaBar(); DrawScore(); DrawKeyBananaStatus(); DrawLivesLeft(); DrawTheMap();}void DrawScore(){	long l,m;	short j;	Rect	rect1, rect2;	l = theGlobals.gScore;	for (j = 0; j < 6; j++)	{		m = l % 10;				SetRect(&rect1, 158 - (j * 26), 421, 184 - (j * 26), 455);		SetRect(&rect2, 1148 + (m * 26), 104, 1174 + (m * 26), 138);				CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits, 			&rect2, &rect1, srcCopy, ( RgnHandle )0L );		l = (l - m)/10;	}}void	DrawTheMap(void){	short				i;	Rect				tempRect;				// first erase the area	SetRect(&tempRect, 205, 402, 301, 474);	SetGWorld(theGWorlds.screenGWorld, nil);	ForeColor(blackColor);	BackColor(whiteColor);	PaintRect(&tempRect);#ifndef DEMO	if (theWorldType == typeTalisman)	{#endif		for (i = 0; i < 12; i++)		{#ifdef DEMO			if ((i == 0) || (i == 3) || (i == 4) || (i == 5) || (i == 6) || (i == 8) || (i == 9) || (i == 10))			{#endif				if (BitTst(&talismanBitField, 15 - i))				{					Rect	source, dest;													source.left = 24 * (i & 3);					source.top = (i & 12) * 6;					source.right = source.left + 24;					source.bottom = source.top + 24;										dest.left = 205 + source.left;					dest.top = 402 + source.top;					dest.right = dest.left + 24;					dest.bottom = dest.top + 24;										CopyBits( &((GrafPtr)theGWorlds.talismanGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits,						&source, &dest, srcCopy, ( RgnHandle )0L );							}#ifdef DEMO			}#endif		}				// now copy to the screen		SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());		ForeColor(blackColor);		BackColor(whiteColor);		SetRect(&tempRect, 205, 402, 301, 474);		CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits,			&tempRect, &tempRect, srcCopy, ( RgnHandle )0L );#ifndef DEMO	}	else	{		Rect dest;		short				count, tens, units;		MonsterSpritePtr	tempMonster = firstMonster;				SetRect(&tempRect, 0, 0, 44, 66);		SetRect(&dest, 205, 405, 249, 471);				CopyBits( &((GrafPtr)theGWorlds.talismanGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits,					&tempRect, &dest, srcCopy, ( RgnHandle )0L );		count = 0;						do		{			if (tempMonster->subKind == theUniqueMonsterNumber) count++;			tempMonster = tempMonster->nextSprite;		}		while (tempMonster != nil);					if (count > 99) count = 99;				units = count % 10;		tens = (count - units)/ 10;				SetRect(&dest, 249, 421, 275, 455);		SetRect(&tempRect, 1148 + (tens * 26), 104, 1174 + (tens * 26), 138);				CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits, 			&tempRect, &dest, srcCopy, ( RgnHandle )0L );		SetRect(&dest, 275, 421, 301, 455);		SetRect(&tempRect, 1148 + (units * 26), 104, 1174 + (units * 26), 138);		CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits, 			&tempRect, &dest, srcCopy, ( RgnHandle )0L );		SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());		ForeColor(blackColor);		BackColor(whiteColor);		SetRect(&tempRect, 205, 402, 301, 474);		CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits,			&tempRect, &tempRect, srcCopy, ( RgnHandle )0L );	}#endif}#ifndef DEMOvoid	HackCheckThree( void ){	short		tempResFile;	long		**tempCode;	Boolean		hacked;		hacked = false;	tempResFile = CurResFile();	UseResFile(theFileStuff.applicationFile);		// check for the hack programs by creator and type		// for all volumes mounted need to call CreatorTypeFileSearch	// until a file is found				// now check if the registration data in the application is same as in the prefs	// if there is a prefs resource in the application, then the game has been	// registered at some point	tempCode = (long **)Get1Resource('CODE', 1);	CheckRegistration();	if (gRegistered)	{		Boolean	cheated = false;		if (tempCode)		{			// the prefs file is a registered one.			// check tempPrefs to make sure it is not fiddled. If it is, unregister it						if ((*tempCode)[318] != 99874) cheated = true;			if ((*tempCode)[143] != (**gPrefs).registrationCode) cheated = true;		}		else cheated = true;		if (cheated)		{			// looks like the registration data from the file isn't the same as in the			// application						(**gPrefs).registrationCode = 0;			CopyString((**gPrefs).registerName, "\pUnregistered");			UpdatePreferences();		}	}	if (tempCode) ReleaseResource((Handle)tempCode);		UseResFile(tempResFile);}#endif#ifdef DEMOvoid WorldCheckTwo(void){	FSSpec 		theFile;	CInfoPBRec	myFileInfo;	OSErr		theError;	// Do Checking for modified file	theError = FSMakeFSSpec(theFileStuff.GWvolRef, theFileStuff.GWParentDirID, "\pLava P'Lava Demo", &theFile);	theError = FindFile(theFileStuff.GWParentDirID, "\pLava P'Lava Demo", &theFile);	// First check file size			myFileInfo.hFileInfo.ioCompletion = NULL;	myFileInfo.hFileInfo.ioVRefNum = theFileStuff.GWvolRef;	myFileInfo.hFileInfo.ioDirID = theFileStuff.GWParentDirID;	myFileInfo.hFileInfo.ioFDirIndex = 0;	myFileInfo.hFileInfo.ioNamePtr = "\pLava P'Lava Demo";		PBGetCatInfoSync( &myFileInfo );		/* get catalog info for file */	// should hide these numbers a bit deeper for better security	if (myFileInfo.hFileInfo.ioFlMdDat != fileDate) hackedTwo = true;}#endif/****************************************************************//*																*//*			 draw the number of lives remaining					*//*																*//****************************************************************/void	DrawLivesLeft(void){	Rect	rect1, rect2;	short	m = theGlobals.gLivesLeft - 1;	if (m > 9) m = 9;	SetRect(&rect1, 568, 421, 594, 455);	SetRect(&rect2, 1148 + (m * 26), 104, 1174 + (m * 26), 138);	CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits, 			&rect2, &rect1, srcCopy, ( RgnHandle )0L );}/****************************************************//*													*//*		Draw the life bar							*//*													*//****************************************************/void DrawLifeBar( void ){	short	lights;	// how many lights to draw	Rect	rect1, rect2;	lights = player.gDarwinLife/19;	// first copy the full bar from the screenGWorld to the Darwin GWorld	SetRect(&rect1, 437, 3, 608, 19);	SetRect(&rect2, 1236, 162, 1407, 178);	CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)theGWorlds.darwinGWorld)->portBits,						&rect1, &rect2, srcCopy, ( RgnHandle )0L );	// now copy from the Darwin GWorld to the part of the Darwin GWorld we are using as temporary storage	SetRect(&rect1, 1236, 72, 1236 + (19 * lights), 88);	SetRect(&rect2, 1236, 162, 1236 + (19 * lights), 178);	CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)theGWorlds.darwinGWorld)->portBits, 			&rect1, &rect2, srcCopy, ( RgnHandle )0L );	// now copy to the screen	SetRect(&rect1, 1236, 162, 1407, 178);	SetRect(&rect2, 437, 3, 608, 19);	CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits, 			&rect1, &rect2, srcCopy, ( RgnHandle )0L );}/****************************************************//*													*//*		Draw the life bar							*//*													*//****************************************************/void DrawStaminaBar( void ){	short	lights;	// how many lights to draw	Rect	rect1, rect2;	lights = player.gDarwinStamina/19;	// first copy the full bar from the screenGWorld to the Darwin GWorld	SetRect(&rect1, 93, 3, 264, 19);	SetRect(&rect2, 1236, 162, 1407, 178);	CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)theGWorlds.darwinGWorld)->portBits,						&rect1, &rect2, srcCopy, ( RgnHandle )0L );	// now copy from the Darwin GWorld to the part of the Darwin GWorld we are using as temporary storage	SetRect(&rect1, 1236, 88, 1236 + (19 * lights), 104);	SetRect(&rect2, 1236, 162, 1236 + (19 * lights), 178);	CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)theGWorlds.darwinGWorld)->portBits, 			&rect1, &rect2, srcCopy, ( RgnHandle )0L );	// now copy to the screen	SetRect(&rect1, 1236, 162, 1407, 178);	SetRect(&rect2, 93, 3, 264, 19);	CopyBits( &((GrafPtr)theGWorlds.darwinGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits, 			&rect1, &rect2, srcCopy, ( RgnHandle )0L );}void	DrawKeyBananaStatus(void){	Rect	sourceRect, tempRect;	short *source, *dest, rows, pixels, t;		// first erase the area		SetRect(&tempRect, 459, 418, 521, 458);	SetGWorld(theGWorlds.screenGWorld, nil);	PaintRect(&tempRect);		if (player.numberOfBananas == 0)	{		if (player.key == 0)		{			// just leave it black		}		else		{			SetRect(&sourceRect, 912 + (player.key * 16), 384, 928 + (player.key * 16), 424);			SetRect(&tempRect, 481, 418, 497, 458);			CopyBits( &((GrafPtr)theGWorlds.platformGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits,				&sourceRect, &tempRect, srcCopy, ( RgnHandle )0L );		}	}	else	{		long l,m;		short j, offset;		if (player.key > 0)		{			SetRect(&sourceRect, 912 + (player.key * 16), 384, 928 + (player.key * 16), 424);			SetRect(&tempRect, 459, 418, 475, 458);			CopyBits( &((GrafPtr)theGWorlds.platformGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits,				&sourceRect, &tempRect, srcCopy, ( RgnHandle )0L );					offset = 10;		}		else offset = 0;			// need to indicate the number and type of bananas		SetRect(&sourceRect, 768, 384, 808, 424);		if (player.powerUp & fastFire) 		{			sourceRect.left += 40;			sourceRect.right += 40;		}		else if (player.powerUp & multipleFire) 		{			sourceRect.left += 80;			sourceRect.right += 80;		}		else if (player.powerUp & powerFire)		{			sourceRect.left += 120;			sourceRect.right += 120;		}				SetRect(&tempRect, 471 + offset, 418, 511 + offset, 458);		CopyBits( &((GrafPtr)theGWorlds.platformGWorld)->portBits, &((GrafPtr)theGWorlds.screenGWorld)->portBits,				&sourceRect, &tempRect, srcCopy, ( RgnHandle )0L );		// now add the number of bananas				// first the x		source = (short *)(theGWorlds.platformMemPtr + (424 * theGWorlds.platformRowOffSet) + 1756);		dest = (short *)(theGWorlds.screenMemPtr + (444 * theGWorlds.screenRowOffSet) + 2 * (471 + offset));				rows = 14;				do		{			for (pixels = 0; pixels < 11; pixels++)			{				t = source[pixels];				if (t != 32767) dest[pixels] = t;			}			dest += theGWorlds.screenRowOffSet/2;			source += theGWorlds.platformRowOffSet/2;		}		while (--rows);		l = player.numberOfBananas;		for (j = 0; j < 2; j++)		{			m = l % 10;						source = (short *)(theGWorlds.platformMemPtr + (424 * theGWorlds.platformRowOffSet) + 2 * (768 + (m * 11)));			dest = (short *)(theGWorlds.screenMemPtr + (444 * theGWorlds.screenRowOffSet) + 2 * (493 + offset - (j * 11)));						rows = 14;						do			{				for (pixels = 0; pixels < 11; pixels++)				{					t = source[pixels];					if (t != 32767) dest[pixels] = t;				}				dest += theGWorlds.screenRowOffSet/2;				source += theGWorlds.platformRowOffSet/2;			}			while (--rows);			l = (l - m)/10;		}	}		// now copy to the screen	SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());	SetRect(&tempRect, 459, 418, 521, 458);	CopyBits( &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits,			&tempRect, &tempRect, srcCopy, ( RgnHandle )0L );}