#include	"globals extern.h"ConveyorSpritePtr AllocateConveyor(void){	ConveyorSpritePtr	tempSprite, temp;		tempSprite = (ConveyorSpritePtr)NewPtrClear(sizeof(ConveyorSprite));	if (tempSprite == nil) FatalError("Sprite Allocation Failed", true);	if (firstConveyor == nil) firstConveyor = tempSprite;	else	{		// find the last hazard in the list				temp = firstConveyor;			while (temp->nextSprite != nil) temp = temp->nextSprite;			temp->nextSprite = tempSprite;		tempSprite->prevSprite = temp;	}	return tempSprite;}ConveyorSpritePtr DisposeConveyor(ConveyorSpritePtr theSprite){	ConveyorSpritePtr	returnValue;	ConveyorSpritePtr	tempSprite = theSprite;	if (theSprite == nil) FatalError("Trying to dispose of zero sprite", true);	returnValue = theSprite->nextSprite;		if (theSprite->nextSprite == nil)	// must be the last talisman in the list	{		if (theSprite == firstConveyor) firstConveyor = nil;	}	else if (theSprite == firstConveyor)	{		firstConveyor = theSprite->nextSprite;	}	if (tempSprite->nextSprite) (tempSprite->nextSprite)->prevSprite = tempSprite->prevSprite;	if (tempSprite->prevSprite) (tempSprite->prevSprite)->nextSprite = tempSprite->nextSprite;	DisposePtr( (Ptr)theSprite);	return returnValue;}void	HandleConveyors(void){	ConveyorSpritePtr tempBelt = firstConveyor;		while (tempBelt)	{		HandleOneConveyor(tempBelt);		tempBelt = tempBelt->nextSprite;	}}void HandleOneConveyor(ConveyorSpritePtr theBelt){	if (frameCount & 1)	{		if (theBelt->kind & maskConveyorLeft) theBelt->frame = (++theBelt->frame) % 5;		else		{			if (theBelt->frame == 0) theBelt->frame = 4;			else theBelt->frame -= 1;		}	}		// check if the conveyor is on the visible part of the screen		if ((theBelt->hArray >= minActualHoriz) && (theBelt->hArray <= maxActualHoriz) &&				(theBelt->vArray >= minActualVert) && (theBelt->vArray <= maxActualVert)) theBelt->needToDraw = true;	else theBelt->needToDraw = false;		if (theBelt->needToDraw)	{		theBelt->dest = (short *)(theGWorlds.safeMemPtr + ((theBelt->theRect.top - (24 * minActualVert)) * theGWorlds.safeRowOffSet)									+ 2 * (theBelt->theRect.left - (24 * minActualHoriz)));		theBelt->source = (short *)(theGWorlds.conveyorMemPtr + (48 * theBelt->frame) + (theGWorlds.platformRowOffSet * theBelt->iconRow));	}}