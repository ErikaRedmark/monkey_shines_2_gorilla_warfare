#include	"globals extern.h"#include	<ctype.h>HazardSpritePtr AllocateHazard(void){	HazardSpritePtr	tempSprite, temp;		tempSprite = (HazardSpritePtr)NewPtrClear(sizeof(HazardSprite));	if (tempSprite == nil) FatalError("Sprite Allocation Failed", true);	if (firstHazard == nil) firstHazard = tempSprite;	else	{		// find the last hazard in the list				temp = firstHazard;			while (temp->nextSprite != nil) temp = temp->nextSprite;			temp->nextSprite = tempSprite;		tempSprite->prevSprite = temp;	}	return tempSprite;}HazardSpritePtr DisposeHazard(HazardSpritePtr theSprite){	HazardSpritePtr	returnValue;	HazardSpritePtr	tempSprite = theSprite;	if (theSprite == nil) FatalError("Trying to dispose of zero sprite", true);	returnValue = theSprite->nextSprite;		if (theSprite->nextSprite == nil)	// must be the last talisman in the list	{		if (theSprite == firstHazard) firstHazard = nil;	}	else if (theSprite == firstHazard)	{		firstHazard = theSprite->nextSprite;	}	if (tempSprite->nextSprite) (tempSprite->nextSprite)->prevSprite = tempSprite->prevSprite;	if (tempSprite->prevSprite) (tempSprite->prevSprite)->nextSprite = tempSprite->nextSprite;	DisposePtr( (Ptr)theSprite);	return returnValue;}#ifndef DEMOvoid CheckRegistrationFour( void ){	long		nameNumber, regcode;	Str255		nameText;	short t,tt;	long		temp;	int worldswitch[2][8] = {	   							1,4,5,11,18,21,24,27,	   							2,3,8,14,17,23,27,29	   						};   		// need to check for blacklisted registration codes	if (((**gPrefs).registerName[0] < 1) || ((**gPrefs).registerName[1] == ' '))	{		// invalid string					CopyString((**gPrefs).registerName, "\pYour name");			(**gPrefs).registrationCode = 0;			gRegistered = 0;			// write out the modified preferences to disk									UpdatePreferences();			return;	}	else if ((**gPrefs).registerName[0] > 31) (**gPrefs).registerName[0] = 31;	 	StringToNum((**gPrefs).registerName, &nameNumber);	CopyString(nameText, (**gPrefs).registerName);	nameNumber &= 0x7FFFFFFF;	regcode = (**serialNumberHandle).serialNumber + nameNumber;	for(t = 1;t <= nameText[0];t++)	/************* do bitswitch for name *************/	{		if (nameText[t] == 0) goto pushon;		nameText[t] = tolower(nameText[t]);		if (nameText[t] == 32) nameText[t] = 128;		temp = nameText[t]-97;		if (BitTst(&regcode,temp)) BitClr(&regcode,temp);		else BitSet(&regcode,temp);	}	 	pushon:	 		for(tt=0;tt<8;tt++) 	{			   		if (BitTst(&regcode,worldswitch[1][tt])) BitClr(&regcode,worldswitch[1][tt]);		else BitSet(&regcode,worldswitch[1][tt]);	}	regcode &= 0x7FFFFFFF;	if ((**gPrefs).registrationCode == regcode) gRegistered = 135;	else 	{		CopyString((**gPrefs).registerName, "\pYour name");		(**gPrefs).registrationCode = 0;		gRegistered = 0;		// write out the modified preferences to disk							UpdatePreferences();	}}#endif/* handle the hazards */void HandleHazards(void){	HazardSpritePtr tempHazard = firstHazard;		while (tempHazard)	{		HandleOneHazard(tempHazard);		tempHazard = tempHazard->nextSprite;	}}void HandleOneHazard(HazardSpritePtr theHazard){	theHazard->frame = (++(theHazard->frame)) % 8;	// check if the item/hazard is on the visible part of the screen	if ((theHazard->hArray >= minActualHoriz) && (theHazard->hArray <= maxActualHoriz) &&				(theHazard->vArray >= minActualVert) && (theHazard->vArray <= maxActualVert)) theHazard->needToDraw = true;	else theHazard->needToDraw = false;		// if we don't need to draw it, nothing more to do		if (theHazard->needToDraw == false) return;	theHazard->dest = (short *)(theGWorlds.safeMemPtr + ((theHazard->theRect.top - (24 * minActualVert)) * theGWorlds.safeRowOffSet) +								 2 * (theHazard->theRect.left - (24 * minActualHoriz)));	theHazard->source = (short *)(theGWorlds.hazardMemPtr + (theHazard->iconRow * theGWorlds.hazardRowOffSet) + (48 * theHazard->frame));}