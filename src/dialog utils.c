#include	"globals extern.h"//____ CenterRectInRect __________________________________________________________________________////	Centers rect1 in rect2//void CenterRectInRect(Rect *rect1, Rect *rect2){	OffsetRect	(rect1,				((rect2->right - rect2->left) - (rect1->right - rect1->left))/2 + rect2->left,				((rect2->bottom - rect2->top) - (rect1->bottom - rect1->top))/2 + rect2->top);}//CenterRectInRectControlHandle	MarksCustomDialog(WindowPtr ){			EventRecord dialogEvent;	short thePart;	WindowPtr whichWindow;	Point		mousePoint;	ControlHandle	dialogControl;	char theChar;	Boolean done = false;	while (!done)	{			if (WaitNextEvent(everyEvent, &dialogEvent, 20L, nil))		{			switch (dialogEvent.what)			{				case keyDown:					theChar = (dialogEvent.message & charCodeMask);					if (theChar == '\r')					{						done = true;					}					break;													case mouseDown:					thePart = FindWindow (dialogEvent.where, &whichWindow);					if (thePart == inContent)					{						mousePoint = dialogEvent.where;						GlobalToLocal(&mousePoint);						thePart = FindControl(mousePoint, whichWindow, &dialogControl);						if (dialogControl)						{							PlayASound(sndClick);							if (TrackControl(dialogControl, dialogEvent.where, nil))								return dialogControl;						}					}					break;				default:					break;			}		}	}	return 0;}#ifdef DEMOvoid	WorldCheckFive(short whichRoom){	if (whichRoom == 0)	{		if (roomWidthTiles != 174) hackedFive = true;	}	else if (whichRoom == 1)	{		if (roomWidthTiles != 121) hackedFive = true;	}	else if (whichRoom == 2)	{		if (roomWidthTiles != 196) hackedFive = true;	}	else hackedFive = true;}#endif#ifndef	DEMOvoid	HackCheckTwo( void ){	short		tempResFile;	long		**tempCode;	Boolean		hacked;		hacked = false;	tempResFile = CurResFile();	UseResFile(theFileStuff.applicationFile);		// now check if the registration data in the application is same as in the prefs	tempCode = (long **)Get1Resource('CODE', 1);	CheckRegistration();	if (gRegistered)	{		Boolean	cheated = false;		if (tempCode)		{			// the prefs file is a registered one.			// check tempPrefs to make sure it is not fiddled. If it is, unregister it						if ((*tempCode)[318] != 99874) cheated = true;			if ((*tempCode)[143] != (**gPrefs).registrationCode) cheated = true;		}		else cheated = true;		if (cheated)		{			// looks like the registration data from the file isn't the same as in the			// application						(**gPrefs).registrationCode = 0;			CopyString((**gPrefs).registerName, "\pUnregistered");			UpdatePreferences();		}	}	if (tempCode) ReleaseResource((Handle)tempCode);		UseResFile(tempResFile);}#endifpascal Boolean MyEventFilter(DialogPtr	theDialog, EventRecord *theEvent, short *itemHit){	char	key;	short	itemType;	ControlHandle	itemHandle;	Rect	itemRect;	ModalFilterUPP standardProc;	Boolean	returnValue = false;	if (theEvent->what == updateEvt)	{		if (theEvent->message == (SInt32)theDialog) 		{			// in case a screen saver activates.			UpdateDialog(theDialog, theDialog->visRgn);			SetCCursor(theUserInterface.myCursor);		}		else		{				// update event for another window			}	}	else if ((theEvent->what == activateEvt) && ((WindowPtr)(theEvent->message) != theDialog))	{		// activate event for another window		}	else if (theEvent->what == keyDown)	{		switch (theEvent->what)		{			case keyDown:			case autoKey:	//{user pressed a key}			{				key = theEvent->message & charCodeMask;								if (key == '\r')				{					//respond as if user clicked okay					GetDialogItem(theDialog, ok, &itemType, &(Handle)itemHandle, &itemRect);										HiliteControl(itemHandle, 10);					GWDelay(0, 10, false);					HiliteControl(itemHandle, 0);										returnValue = true;	//{event's being handled}					*itemHit = ok;	//{return the default button}				}				else if ((theEvent->modifiers & cmdKey) && (key == '.'))				{					// user pressed Cmd-pd					// handle as if user clicked Cancel					GetDialogItem(theDialog, cancel, &itemType, &(Handle)itemHandle, &itemRect);					HiliteControl(itemHandle, 10);					GWDelay(0, 10, false);					HiliteControl(itemHandle, 0);										returnValue = true;	//{event's being handled}					*itemHit = cancel;	//{return the Cancel button}				}			}		}	}	else	{		OSErr err = GetStdFilterProc(&standardProc);        if (err == noErr) CallModalFilterProc (standardProc, theDialog, theEvent, itemHit);    }	return returnValue;}pascal Boolean MySoundSliderEventFilter(DialogPtr theDialog, EventRecord *theEvent, short *itemHit){	char			key;	short			itemType, thePart;	ControlHandle	itemHandle;	Rect			itemRect;	WindowPtr		whichWindow;	Point			mousePoint;	ControlHandle	theControl;	Boolean	returnValue = false;	if (theEvent->what == updateEvt)	{		if (theEvent->message == (SInt32)theDialog) 		{			// in case a screen saver activates.			UpdateDialog(theDialog, theDialog->visRgn);			Draw1Control(theUserInterface.soundSliderBar);			SetCCursor(theUserInterface.myCursor);		}		else		{				// update event for another window		}	}	else if ((theEvent->what == activateEvt) && ((WindowPtr)(theEvent->message) != theDialog)) {}	else switch (theEvent->what)	{		case keyDown:		case autoKey:	//{user pressed a key}			key = theEvent->message & charCodeMask;						if (key == '\r')			{				//respond as if user clicked okay				GetDialogItem(theDialog, ok, &itemType, &(Handle)itemHandle, &itemRect);								HiliteControl(itemHandle, 10);				GWDelay(0, 10, false);				HiliteControl(itemHandle, 0);								returnValue = true;	//{event's being handled}				*itemHit = ok;	//{return the default button}			}			else if ((theEvent->modifiers & cmdKey) && (key == '.'))			{				// user pressed Cmd-pd				// handle as if user clicked Cancel				GetDialogItem(theDialog, cancel, &itemType, &(Handle)itemHandle, &itemRect);				HiliteControl(itemHandle, 10);				GWDelay(0, 10, false);				HiliteControl(itemHandle, 0);								returnValue = true;	//{event's being handled}				*itemHit = cancel;	//{return the Cancel button}			}			break;		case mouseDown:			thePart = FindWindow (theEvent->where, &whichWindow);				switch (thePart)			{				case inContent:					mousePoint = theEvent->where;					GlobalToLocal(&mousePoint);					thePart = FindControl(mousePoint, whichWindow, &theControl);					if (theControl == theUserInterface.soundSliderBar)					{						TrackControl(theUserInterface.soundSliderBar, theEvent->where,  (ControlActionUPP)-1);						SetSoundVolume(GetControlValue(theUserInterface.soundSliderBar));	// set it temporarily to						PlayASound(sndVolumeFeedback);							// give some feedback					}			}	}	return returnValue;}pascal Boolean MyMusicSliderEventFilter(DialogPtr theDialog, EventRecord *theEvent, short *itemHit){	char			key;	short			itemType, thePart;	ControlHandle	itemHandle;	Rect			itemRect;	WindowPtr		whichWindow;	Point			mousePoint;	ControlHandle	theControl;	Boolean	returnValue = false;	if (theEvent->what == updateEvt)	{		if (theEvent->message == (SInt32)theDialog) 		{			// in case a screen saver activates.			UpdateDialog(theDialog, theDialog->visRgn);			Draw1Control(theUserInterface.soundSliderBar);			SetCCursor(theUserInterface.myCursor);		}		else		{				// update event for another window		}	}	else if ((theEvent->what == activateEvt) && ((WindowPtr)(theEvent->message) != theDialog)) {}	else switch (theEvent->what)	{		case keyDown:		case autoKey:	//{user pressed a key}			key = theEvent->message & charCodeMask;						if (key == '\r')			{				//respond as if user clicked okay				GetDialogItem(theDialog, ok, &itemType, &(Handle)itemHandle, &itemRect);								HiliteControl(itemHandle, 10);				GWDelay(0, 10, false);				HiliteControl(itemHandle, 0);								returnValue = true;	//{event's being handled}				*itemHit = ok;	//{return the default button}			}			else if ((theEvent->modifiers & cmdKey) && (key == '.'))			{				// user pressed Cmd-pd				// handle as if user clicked Cancel				GetDialogItem(theDialog, cancel, &itemType, &(Handle)itemHandle, &itemRect);				HiliteControl(itemHandle, 10);				GWDelay(0, 10, false);				HiliteControl(itemHandle, 0);								returnValue = true;	//{event's being handled}				*itemHit = cancel;	//{return the Cancel button}			}			break;		case mouseDown:			thePart = FindWindow (theEvent->where, &whichWindow);				switch (thePart)			{				case inContent:					mousePoint = theEvent->where;					GlobalToLocal(&mousePoint);					thePart = FindControl(mousePoint, whichWindow, &theControl);					if (theControl == theUserInterface.soundSliderBar)					{						TrackControl(theUserInterface.soundSliderBar, theEvent->where,  (ControlActionUPP)-1);						SetMusicVolume(GetControlValue(theUserInterface.soundSliderBar));					}			}	}	return returnValue;}