#include	"globals extern.h"/* Initialize Sound Stuff */void	InitSoundChannels(){	short t;	Boolean stereo;	OSErr err;	long feature;	err = Gestalt( gestaltSoundAttr, &feature );	if ( err == noErr ) stereo = ((feature & (1L << gestaltStereoCapability)) != 0);	else stereo = false;	for(t = 0; t < 16; t++)	{ 		if (!SndNewChannel(&theAudioStuff.soundchannel[t], sampledSynth, (stereo ? initStereo : initMono)			+ initNoDrop + initNoInterp, nil))		{			theAudioStuff.soundchannel[t]->qLength = 128;		}		else		{			// TODO error handling		}	}	if (!SndNewChannel(&theAudioStuff.beanieChannel, sampledSynth, (stereo ? initStereo : initMono)		+ initNoDrop + initNoInterp, nil))	{		theAudioStuff.beanieChannel->qLength = 128;	}	if (!SndNewChannel(&theAudioStuff.jetPackChannel, sampledSynth, (stereo ? initStereo : initMono)		+ initNoDrop + initNoInterp, nil))	{		theAudioStuff.jetPackChannel->qLength = 128;	}		if (!SndNewChannel(&theAudioStuff.damageChannel, sampledSynth, (stereo ? initStereo : initMono)		+ initNoDrop + initNoInterp, nil))	{		theAudioStuff.damageChannel->qLength = 128;	}	// one for AIFF music	if (!SndNewChannel(&theAudioStuff.musicChannel, sampledSynth, initStereo + initNoDrop + initNoInterp, nil))	{		theAudioStuff.musicChannel->qLength = 128;	}	UseResFile(theFileStuff.GWDataFileNumber);  	for (t = 0; t < 48; t++) 	{ 		theAudioStuff.theSounds[t] = Get1Resource('snd ', t + 128); 		if ((theAudioStuff.theSounds[t] == 0) || (ResError() != noErr)) 				FatalError("Error loading default sounds", false); 		 		MoveHHi(theAudioStuff.theSounds[t]);		HLock(theAudioStuff.theSounds[t]);	}	UseResFile(theFileStuff.applicationFile);}void	ReleaseSounds(void){ 		short t;	for (t = 0; t < 47; t++) if (theAudioStuff.theSounds[t]) ReleaseResource(theAudioStuff.theSounds[t]);}/***************** sound *******************/void PlayASound(short whichSound){	if ((**gPrefs).soundVolume > 0)	{		theAudioStuff.channel++;		if (theAudioStuff.channel > 15) theAudioStuff.channel = 0;	 		SndPlay(theAudioStuff.soundchannel[theAudioStuff.channel],(SndListHandle)theAudioStuff.theSounds[whichSound - 128],true);	}}void BeanieSound(void){	if ((**gPrefs).soundVolume > 0)	{		SndPlay(theAudioStuff.beanieChannel,(SndListHandle)theAudioStuff.theSounds[sndBeanieUsed - 128],true);	}}void JetPackSound(void){	if ((**gPrefs).soundVolume > 0)	{		SndPlay(theAudioStuff.jetPackChannel,(SndListHandle)theAudioStuff.theSounds[sndJetPackUsed - 128],true);	}}void DamageSound(void){	if ((**gPrefs).soundVolume > 0)	{		SndPlay(theAudioStuff.damageChannel,(SndListHandle)theAudioStuff.theSounds[sndDarwinLoseEnergy - 128],true);	}}void	SetSoundVolume(short volume){	short t;	SndCommand	mySndCmd;	for(t = 0; t < 16; t++)	{ 		// set the volume for this channel				mySndCmd.param1 = 0;		mySndCmd.param2 = (volume * 2097152) + (volume * 32);		mySndCmd.cmd = volumeCmd;		SndDoImmediate(theAudioStuff.soundchannel[t], &mySndCmd);	}	mySndCmd.param1 = 0;	mySndCmd.param2 = (volume * 2097152) + (volume * 32);	mySndCmd.cmd = volumeCmd;	SndDoImmediate(theAudioStuff.beanieChannel, &mySndCmd);	mySndCmd.param1 = 0;	mySndCmd.param2 = (volume * 2097152) + (volume * 32);	mySndCmd.cmd = volumeCmd;	SndDoImmediate(theAudioStuff.jetPackChannel, &mySndCmd);	mySndCmd.param1 = 0;	mySndCmd.param2 = (volume * 2097152) + (volume * 32);	mySndCmd.cmd = volumeCmd;	SndDoImmediate(theAudioStuff.damageChannel, &mySndCmd);}void SoundVolumeDialog(void){	Rect itemRect, tempRect;	short itemType, itemHit;	DialogPtr	theDialog;	Handle		okItemHandle;	RgnHandle	theRegion;	ModalFilterUPP	myModalFilter;	short		tempSoundVolume;	// regcode is the calculated code for this name/number combo	Boolean dialogDone = false;		UseResFile(theFileStuff.GWDataFileNumber);	theDialog = GetNewDialog(15001, nil, (WindowPtr) -1L);	GetDialogItem(theDialog, ok, &itemType, &okItemHandle, &itemRect);		dialogDone = false;	SetPort(theDialog);	DrawDialog(theDialog);		theUserInterface.soundSliderBar = GetNewControl(1000, theDialog);			SetControlValue(theUserInterface.soundSliderBar, (**gPrefs).soundVolume);	ShowControl(theUserInterface.soundSliderBar);    BeginUpdate(theDialog);    EndUpdate(theDialog);	FlushEvents(everyEvent,0);	SetDialogDefaultItem(theDialog, ok);	SetDialogCancelItem(theDialog, cancel);	myModalFilter = NewModalFilterProc((RoutineDescriptor *)&MySoundSliderEventFilter);	Draw1Control(theUserInterface.soundSliderBar);	while (!dialogDone)	{		ModalDialog(myModalFilter, &itemHit);				switch (itemHit)		{			case ok:			case cancel:				dialogDone = true;				break;		}				tempSoundVolume = GetControlValue((ControlHandle)theUserInterface.soundSliderBar);	}		DisposeRoutineDescriptor(myModalFilter);	DisposeControl(theUserInterface.soundSliderBar);		DisposeDialog(theDialog);	SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());	// update the window behind the control	theRegion = theUserInterface.theWindow->visRgn;		tempRect.left = (**theRegion).rgnBBox.left;	tempRect.right = (**theRegion).rgnBBox.right;	tempRect.top = (**theRegion).rgnBBox.top;	tempRect.bottom = (**theRegion).rgnBBox.bottom;		CopyBits(  &((GrafPtr)theGWorlds.screenGWorld)->portBits, &((GrafPtr)(&theUserInterface.myCWindowRecord.port))->portBits,		&tempRect, &tempRect, srcCopy, ( RgnHandle )0L );			UpdateControls(theUserInterface.theWindow, theRegion);	if (itemHit != cancel)	{		CheckItem(theUserInterface.soundMenu, ((**gPrefs).soundVolume) + 1, false);		(**gPrefs).soundVolume = tempSoundVolume;		UpdatePreferences();		SetSoundVolume((**gPrefs).soundVolume);		CheckItem(theUserInterface.soundMenu, ((**gPrefs).soundVolume) + 1, true);	}	else	{		// hit cancel, so restore the sound volume		SetSoundVolume((**gPrefs).soundVolume);	}	UseResFile(theFileStuff.applicationFile);	SetCCursor(theUserInterface.myCursor);}