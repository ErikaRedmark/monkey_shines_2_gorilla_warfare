#include "globals extern.h"void NewGame(FSSpec *theFile){	long	score;	OSErr	theError;	Boolean	fsspecAllocated = false;	Boolean	done = false;	#ifndef DEMO		CheckRegistration();		if (!gRegistered)	RegisterDialog();		if (!gRegistered)	return;	#endif	// get rid of the control screen	HideTheMenuBar();	CustomHideCursor();	KillControls(theUserInterface.theWindow);		// manually compact memory		PurgeMem(maxSize);		CompactMem(maxSize);		// TODO - check if the file is a saved game or a world file FSpGetFInfo		// find out which level to start on		if (theFile == nil)	{		theFile = (FSSpec *)NewPtrClear(sizeof(FSSpec));		if (theFile == nil) FatalError("Error creating file spec", true);		fsspecAllocated = true;			if ((theError = GetStartingLevel(theFile)) == noErr)		{			// user selected one of the buttons, and the game located it		}		else		{			// must have hit cancel						DisposePtr((Ptr)theFile);			theFile = nil;			fsspecAllocated = false;	// don't dispose of it again		}	}		if (theFile != nil)	{		score = GameLoop(theFile);			// check if it was a high score, and handle it accordingly				HandleHighScore(score);	}		if (fsspecAllocated) DisposePtr((Ptr)theFile);	// redraw the control screen and fade in again	StartInterfaceMusic();	FlushEvents( keyDownMask + autoKeyMask, 0 );	// get rid of key presses	DrawControlScreen(true);}