#include	"globals extern.h"void SetupWindow(void){	Rect			tempRect;	// in case screen is set to larger than 640 x 480	if ((((**theUserInterface.gameGDevice).gdRect.right - (**theUserInterface.gameGDevice).gdRect.left) != 640) ||			(((**theUserInterface.gameGDevice).gdRect.bottom - (**theUserInterface.gameGDevice).gdRect.top) != 480))	{		// need a blanking window			theUserInterface.blankingWindow = NewCWindow(&theUserInterface.blankingWindowRecord, &(**theUserInterface.gameGDevice).gdRect, "\p", false, plainDBox, (WindowPtr)-1L, false, (long)nil);		ShowWindow(theUserInterface.blankingWindow);		SetGWorld(&theUserInterface.blankingWindowRecord.port, GetMainDevice());		ForeColor(blackColor);		PaintRect(&theUserInterface.blankingWindowRecord.port.portRect);	}	tempRect.left = ((**theUserInterface.gameGDevice).gdRect.left + (**theUserInterface.gameGDevice).gdRect.right - 640)/2;	tempRect.right = tempRect.left + 640;	tempRect.top = ((**theUserInterface.gameGDevice).gdRect.top + (**theUserInterface.gameGDevice).gdRect.bottom - 480)/2;	tempRect.bottom = tempRect.top + 480;	/* set up all the drawing environments */	/* make sure port is set to window */	theUserInterface.theWindow  = NewCWindow(&theUserInterface.myCWindowRecord, &tempRect, "\p", false, plainDBox, (WindowPtr)-1L, false, (long)nil);	ShowWindow(theUserInterface.theWindow);	SetGWorld(&theUserInterface.myCWindowRecord.port, GetMainDevice());}void	SetupGWorlds(void){	Rect	tempRect;	short	i;	Byte	*sceneryPtr;	PicHandle		tempPict;	CGrafPtr	saved;	GDHandle	savedGD;		GetGWorld(&saved, &savedGD);	SetRect(&tempRect, 0, 0, 640, 480);	NewGWorld(&theGWorlds.screenGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.screenPixMap = GetGWorldPixMap(theGWorlds.screenGWorld);	SetRect(&tempRect, 0,0, 1408, 576);	NewGWorld(&theGWorlds.darwinGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.darwinPixMap = GetGWorldPixMap(theGWorlds.darwinGWorld);	SetRect(&tempRect, 0, 0, 1344, 480);	NewGWorld(&theGWorlds.platformGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.platformPixMap = GetGWorldPixMap(theGWorlds.platformGWorld);	SetRect(&tempRect, 0, 0, 576 + 48, 360 + 48);	NewGWorld(&theGWorlds.safeGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.safePixMap = GetGWorldPixMap(theGWorlds.safeGWorld);	SetRect(&tempRect, 0, 0, 384, 960);	NewGWorld(&theGWorlds.itemGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.itemPixMap = GetGWorldPixMap(theGWorlds.itemGWorld);	SetRect(&tempRect, 0, 0, 192, 192);	NewGWorld(&theGWorlds.hazardGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.hazardPixMap = GetGWorldPixMap(theGWorlds.hazardGWorld);	SetRect(&tempRect, 0, 0, 96, 72);	NewGWorld(&theGWorlds.talismanGWorld, 16, &tempRect, nil, nil, 0L);		theGWorlds.talismanPixMap = GetGWorldPixMap(theGWorlds.talismanGWorld);	SetRect(&tempRect, 0, 0, 576, 360);	NewGWorld(&theGWorlds.parallaxBackGWorld, 16, &tempRect, nil, nil, 0L);		theGWorlds.parallaxBackPixMap = GetGWorldPixMap(theGWorlds.parallaxBackGWorld);	SetRect(&tempRect, 0, 0, 268, 144);	NewGWorld(&theGWorlds.saveMessageGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.saveMessagePixMap = GetGWorldPixMap(theGWorlds.saveMessageGWorld);#ifdef DEMO	SetRect(&tempRect, 0, 0, 268, 144);	NewGWorld(&theGWorlds.saveMessageTwoGWorld, 16, &tempRect, nil, nil, 0L);	theGWorlds.saveMessageTwoPixMap = GetGWorldPixMap(theGWorlds.saveMessageTwoGWorld);#endif	MoveHHi((Handle)theGWorlds.screenPixMap);	LockPixels(theGWorlds.screenPixMap);	theGWorlds.screenMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.screenPixMap);	theGWorlds.screenRowOffSet = (0x7FFF & (**theGWorlds.screenPixMap).rowBytes);	MoveHHi((Handle)theGWorlds.darwinPixMap);	LockPixels(theGWorlds.darwinPixMap);	theGWorlds.darwinMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.darwinPixMap);	theGWorlds.darwinRowOffSet = (0x7FFF & (**theGWorlds.darwinPixMap).rowBytes);	MoveHHi((Handle)theGWorlds.platformPixMap);	LockPixels(theGWorlds.platformPixMap);	theGWorlds.platformMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.platformPixMap);	theGWorlds.platformRowOffSet = (0x7FFF & (**theGWorlds.platformPixMap).rowBytes);	MoveHHi((Handle)theGWorlds.saveMessagePixMap);	LockPixels(theGWorlds.saveMessagePixMap);#ifdef DEMO	MoveHHi((Handle)theGWorlds.saveMessageTwoPixMap);	LockPixels(theGWorlds.saveMessageTwoPixMap);#endif	// now pre-calculate all the platorm/scenery addresses		for (i = 0; i < 256; i++)	{		platformAddresses[i + 1] = (short *)(theGWorlds.platformMemPtr + (48 * (i & 15))											+ (theGWorlds.platformRowOffSet * ((i & 112) >> 4) * 24) + (6 * (i & 128)));	}		sceneryPtr = theGWorlds.platformMemPtr + (192 * theGWorlds.platformRowOffSet);	for (i = 0; i < 384; i++)	{		sceneryAddresses[i + 1] = (short *)(sceneryPtr + (48 * (i & 31)) + (theGWorlds.platformRowOffSet * ((i & 480) >> 5) * 24));	}	MoveHHi((Handle)theGWorlds.safePixMap);	LockPixels(theGWorlds.safePixMap);	theGWorlds.safeMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.safePixMap);	theGWorlds.safeRowOffSet = (0x7FFF & (**theGWorlds.safePixMap).rowBytes);	theGWorlds.safeMemPtr += (24 * theGWorlds.safeRowOffSet) + 48;	// first REAL byte, 48 since short *	MoveHHi((Handle)theGWorlds.itemPixMap);	LockPixels(theGWorlds.itemPixMap);	theGWorlds.itemMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.itemPixMap);	theGWorlds.itemRowOffSet = (0x7FFF & (**theGWorlds.itemPixMap).rowBytes);		MoveHHi((Handle)theGWorlds.hazardPixMap);	LockPixels(theGWorlds.hazardPixMap);	theGWorlds.hazardMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.hazardPixMap);	theGWorlds.hazardRowOffSet = (0x7FFF & (**theGWorlds.hazardPixMap).rowBytes);	MoveHHi((Handle)theGWorlds.talismanPixMap);	LockPixels(theGWorlds.talismanPixMap);	theGWorlds.talismanMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.talismanPixMap);	theGWorlds.talismanRowOffSet = (0x7FFF & (**theGWorlds.talismanPixMap).rowBytes);	MoveHHi((Handle)theGWorlds.parallaxBackPixMap);	LockPixels(theGWorlds.parallaxBackPixMap);	theGWorlds.parallaxBackMemPtr = (Byte *)GetPixBaseAddr(theGWorlds.parallaxBackPixMap);	theGWorlds.parallaxBackRowOffSet = (0x7FFF & (**theGWorlds.parallaxBackPixMap).rowBytes);	UseResFile(theFileStuff.GWDataFileNumber);	SetGWorld(theGWorlds.darwinGWorld, nil);	tempPict = GetPicture(128);	if (tempPict == nil) FatalError("Error loading PICT 128 (Darwin)", true);	DrawPicture(tempPict, &(theGWorlds.darwinGWorld->portRect));	ReleaseResource((Handle)tempPict);		// now the banana graphics	// these are now in the Darwin GWorld, so just set the pointer	theGWorlds.bananaMemPtr = theGWorlds.darwinMemPtr + (138 * theGWorlds.darwinRowOffSet) + 2432;	// collectables	tempPict = GetPicture(129);		if (tempPict == nil) FatalError("Error loading PICT 129", true);	SetGWorld(theGWorlds.itemGWorld, nil);	DrawPicture(tempPict, &(theGWorlds.itemGWorld->portRect));	ReleaseResource((Handle)tempPict);	for (i = 0; i < 8; i++)	{		tempPict = GetPicture(200 + i);		if (tempPict == nil) FatalError("Error loading door PICT", true);			SetRect(&tempRect, 0, 0, (**tempPict).picFrame.right, (**tempPict).picFrame.bottom);		NewGWorld(&theGWorlds.doorGWorld[i], 16, &tempRect, nil, nil, 0L);		theGWorlds.doorPixMap[i] = GetGWorldPixMap(theGWorlds.doorGWorld[i]);		MoveHHi((Handle)theGWorlds.doorPixMap[i]);		LockPixels(theGWorlds.doorPixMap[i]);				theGWorlds.doorMemPtr[i] = (Byte *)GetPixBaseAddr(theGWorlds.doorPixMap[i]);		SetGWorld(theGWorlds.doorGWorld[i], nil);		DrawPicture(tempPict, &tempRect);		ReleaseResource((Handle)tempPict);	}		tempPict = GetPicture(2002);	if (tempPict == nil) FatalError("Error loading PICT 2002", true);	SetGWorld(theGWorlds.saveMessageGWorld, nil);	SetRect(&tempRect, 0, 0, 268, 144);	DrawPicture(tempPict, &tempRect);	ReleaseResource((Handle)tempPict);	#ifdef	DEMO		tempPict = GetPicture(2003);		if (tempPict == nil) FatalError("Error loading PICT 2003", true);		SetGWorld(theGWorlds.saveMessageTwoGWorld, nil);		SetRect(&tempRect, 0, 0, 268, 144);		DrawPicture(tempPict, &tempRect);		ReleaseResource((Handle)tempPict);	#endif	SetGWorld(saved, savedGD);}#ifdef DEMOvoid WorldCheckOne(void){	FSSpec 		theFile;	CInfoPBRec	myFileInfo;	OSErr		theError;	// Do Checking for modified file	theError = FSMakeFSSpec(theFileStuff.GWvolRef, theFileStuff.GWParentDirID, "\pLava P'Lava Demo", &theFile);	theError = FindFile(theFileStuff.GWParentDirID, "\pLava P'Lava Demo", &theFile);	// First check file size			myFileInfo.hFileInfo.ioCompletion = NULL;	myFileInfo.hFileInfo.ioVRefNum = theFileStuff.GWvolRef;	myFileInfo.hFileInfo.ioDirID = theFileStuff.GWParentDirID;	myFileInfo.hFileInfo.ioFDirIndex = 0;	myFileInfo.hFileInfo.ioNamePtr = "\pLava P'Lava Demo";		PBGetCatInfoSync( &myFileInfo );		/* get catalog info for file */	// should hide these numbers a bit deeper for better security	if (myFileInfo.hFileInfo.ioFlRLgLen != fileLength) hackedOne = true;}#endif